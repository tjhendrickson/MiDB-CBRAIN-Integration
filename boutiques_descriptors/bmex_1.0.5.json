{
    "name":                "BME-X",
    "tool-version":        "1.0.5",
    "author":              "Yue Sun, Limei Wang, Gang Li, Weili Lin, Li Wang",
    "description":         "BME-X: A foundation model for enhancing magnetic resonance images and downstream segmentation, registration and diagnostic tasks.",
    "url":                 "https://brain-mri-enhancement.readthedocs.io/en/latest/",
    "command-line":        "true [DERIVATIVES_PREFIX]; python /BME-X.py --bids_root [SubjectDirectory] --output_dir [BMEXOutputDirectoryName] [SessionLabel]",
    "schema-version":      "0.5",
    "container-image":     {
      "type":  "singularity",
      "index": "docker://",
      "image": "yuesun814/bme-x:v1.0.5"
    },
    "inputs":              [
      {
        "id":          "SubjectDirectory",
        "name":        "Subject Directory",
        "description": "The study-wide BIDS directory. In CBRAIN this is also referred to (and used) as the subject directory since a new BIDS dir will be made for the selected subject prior to processing.",
        "type":        "File",
        "optional":    false,
        "value-key":   "[SubjectDirectory]"
      },
      {
        "id":          "BMEXOutputDirectoryName",
        "name":        "BME-X Output Directory",
        "description": "The name of the output directory to store cleaned anatomicals and brain masks.",
        "type":        "String",
        "optional":    false,
        "value-key":   "[BMEXOutputDirectoryName]"
      },
      {
        "id":                "SessionLabel",
        "name":              "Session Label",
        "description":       "select a specific session to be processed (without ses- prefix)",
        "type":              "String",
        "optional":          true,
        "command-line-flag": "--session_id",
        "value-key":         "[SessionLabel]"
      },
      {
        "id":            "derivatives_prefix",
        "name":          "derivatives_prefix",
        "description":   "Folders to put before the pipeline specific folder. By default this will look like DataProvider/derivatives/PipelineName, where pipeline name is specific to the current pipeline. The provided string must end in /",
        "type":          "String",
        "optional":      true,
        "default-value": "derivatives/",
        "value-key":     "[DERIVATIVES_PREFIX]"
      }
    ],
    "output-files":        [
      {
        "id":            "OutputDirectory",
        "name":          "Output Directory",
        "description":   "The output directory to store outcomes of preprocessing and reports",
        "optional":      false,
        "path-template": "[BMEXOutputDirectoryName]/[SubjectDirectory]"
      }
    ],
    "suggested-resources": {
      "cpu-cores": 1,
      "ram": 24,
      "walltime-estimate": 25000
    },
    "tags":                {
      "application-type": [
        "bids"
      ],
      "domain": [
        "neuroinformatics",
        "anatomical",
        "enhancement"
      ]
    },
    "custom":              {
      "cbrain:readonly-input-files":  true,
      "cbrain:author":                "Erik Lee <leex6144@umn.edu>",
      "cbrain:allow_empty_strings":   [
        "derivatives_prefix"
      ],
      "cbrain:override-string-input-ruby-regex": {
        "derivatives_prefix": ":relative-path:"
      },
      "cbrain:no-run-id-for-outputs": [
        "OutputDirectory"
      ],
      "cbrain:integrator_modules":    {
        "BoutiquesFileTypeVerifier": {
          "SubjectDirectory": [
            "BidsSubject"
          ]
        },
        "BoutiquesFileNameMatcher": {
          "SubjectDirectory": "^sub-[a-zA-Z0-9_]+$"
        },
        "BoutiquesOutputFileTypeSetter": {
          "OutputDirectory": "BmexOutput"
        },
        "BoutiquesForcedOutputBrowsePath": {
          "OutputDirectory": "[DERIVATIVES_PREFIX]bme_x"
        },
        "BoutiquesTaskLogsCopier": {
          "stdout": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/stdout.log",
          "stderr": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/stderr.log",
          "runtime": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/runtime_info.properties",
          "descriptor": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/boutiques_descriptor.json",
          "invoke": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/boutiques_invoke.json",
          "jobscript": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/job_script.sh",
          "cbrain_params": "[BMEXOutputDirectoryName]/[SubjectDirectory]/ses-[SessionLabel]/.cbrain/cbrain_params.json"
        },
        "BoutiquesBidsSubjectFileSelector": {
          "SubjectDirectory": "all_to_keep"
        },
        "BoutiquesPostProcessingCleaner": [
          "[BMEXOutputDirectoryName]",
          "[SubjectDirectory]"
        ],
        "BoutiquesBidsSingleSubjectMaker": "SubjectDirectory"
      }
    }
  }
